# 🚀 사용자 직급 필드 마이그레이션 가이드

## 📋 개요
이 마이그레이션은 기존 사용자들에게 `position` (직급) 필드를 추가하고 적절한 기본값을 설정하는 스크립트입니다.

## 🎯 목적
- 기존 사용자들에게 `position` 필드 추가
- 사용자 레벨과 회사 정보에 따른 적절한 기본 직급 설정
- 데이터 일관성 확보

## 🛠️ 실행 방법

### 방법 1: npm 스크립트 사용 (권장)
```bash
cd backend
npm run migrate:positions
```

### 방법 2: 직접 실행
```bash
cd backend
node runMigration.js
```

### 방법 3: 전체 마이그레이션
```bash
cd backend
npm run migrate
```

## 📊 마이그레이션 규칙

### 기본 직급 설정 로직
1. **기본값**: `사원`
2. **회사 정보가 있는 경우**: `대리`
3. **레벨 기반 직급**:
   - 레벨 10 이상: `부장`
   - 레벨 5 이상: `과장`
   - 레벨 3 이상: `대리`
   - 그 외: `사원`

### 지원하는 직급
- 사원
- 대리
- 과장
- 차장
- 부장
- 이사
- 상무
- 전무
- 부사장
- 사장
- 기타

## 🔍 실행 결과 예시

```
🎯 CRM 시스템 사용자 직급 필드 마이그레이션
=====================================

🚀 사용자 직급 필드 마이그레이션을 시작합니다...

📊 총 5명의 사용자에게 직급 필드가 필요합니다.
✅ sj.kang@zwcad.kr (강세진 zk) - 직급: 부장 설정 완료
✅ user1@example.com (사용자1) - 직급: 과장 설정 완료
✅ user2@example.com (사용자2) - 직급: 대리 설정 완료
✅ user3@example.com (사용자3) - 직급: 사원 설정 완료
✅ user4@example.com (사용자4) - 직급: 사원 설정 완료

🎉 마이그레이션 완료!
   ✅ 성공: 5명
   ❌ 실패: 0명

📊 직급별 사용자 수 통계:
   부장: 1명
   과장: 1명
   대리: 1명
   사원: 2명

📈 전체 사용자 수: 5명

🎯 마이그레이션이 완료되었습니다.
💡 이제 모든 사용자가 position 필드를 가지고 있습니다.
🔌 MongoDB 연결이 종료되었습니다.
```

## ⚠️ 주의사항

1. **백업 권장**: 실행 전 데이터베이스 백업을 권장합니다.
2. **서버 중단**: 마이그레이션 중에는 서버를 중단하는 것이 좋습니다.
3. **권한 확인**: MongoDB 연결 권한이 있는지 확인하세요.
4. **환경 변수**: `.env` 파일에 `MONGODB_URI`가 설정되어 있는지 확인하세요.

## 🔧 문제 해결

### MongoDB 연결 실패
```bash
# .env 파일 확인
MONGODB_URI=mongodb://localhost:27017/crm_project

# 또는 직접 연결 문자열 지정
MONGODB_URI=mongodb://username:password@host:port/database
```

### 권한 오류
```bash
# MongoDB 사용자 권한 확인
# 데이터베이스 읽기/쓰기 권한 필요
```

### 스크립트 실행 권한
```bash
# Windows
npm run migrate:positions

# Linux/Mac
chmod +x runMigration.js
./runMigration.js
```

## 📞 지원

문제가 발생하면 다음을 확인하세요:
1. MongoDB 연결 상태
2. 환경 변수 설정
3. 사용자 권한
4. 로그 메시지

---

**🎉 마이그레이션이 완료되면 모든 사용자가 직급 정보를 가지게 됩니다!** 